<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <!--Set visual viewport size for mobile devices to the device size,
        witch results in a scale of 1 and a 1:1 mapping between CSS pixels
        and Qt device independent pixels. -->
    <meta name="viewport" content="width=device-width, height=device-height, user-scalable=0"/>
    <meta name="description" content="This content was rendered in using C++,QML and WASM" />
    <meta name="keywords" content="QML, WASM, C++" />
    <meta name="robots" content="index, follow" />
    <meta name="google-site-verification" content="ag5d0o0QkNRrBTGvjOpakX2NM943hpggL8hlgvQilpw" />
    <title>Dynamic QML</title>
    <style>
      /* Make the html body cover the entire (visual) viewport with no scroll bars. */
      html, body { padding: 0; margin: 0; overflow:hidden; height: 100% }
      /* Make the canvas cover the entire body */
      canvas { height:100%; width:100%; }
    </style>
  </head>
  <body onload="init()" style="background-color: #171C2C">
    <figure style="overflow:visible;" id="qtspinner">
      <center style="margin-top:1.5em; line-height:150%; color: #ffffff;">
        <img src="logo.svg" width="200" height="200" style="display:block"></img>
        <strong>QML App is loading: appqmlwasm</strong>
        <div id="qtstatus"></div>
        <noscript>JavaScript is disabled. Please enable JavaScript to use this application.</noscript>
      </center>
    </figure>
    <canvas id="qtcanvas"></canvas>
    <script type='text/javascript'>
      let qtLoader = undefined;
      function init() {
        var spinner = document.querySelector('#qtspinner');
        var canvas = document.querySelector('#qtcanvas');
        var status = document.querySelector('#qtstatus')
        
        qtLoader = QtLoader({
            canvasElements : [canvas],
            showLoader: function(loaderStatus) {
                spinner.style.display = 'block';
                canvas.style.display = 'none';
                status.innerHTML = loaderStatus + "...";
            },
            showError: function(errorText) {
                status.innerHTML = errorText;
                spinner.style.display = 'block';
                canvas.style.display = 'none';
            },
            showExit: function() {
                status.innerHTML = "Application exit";
                if (qtLoader.exitCode !== undefined)
                    status.innerHTML += " with code " + qtLoader.exitCode;
                if (qtLoader.exitText !== undefined)
                    status.innerHTML += " (" + qtLoader.exitText + ")";
                spinner.style.display = 'block';
                canvas.style.display = 'none';
            },
            showCanvas: function() {
                spinner.style.display = 'none';
                canvas.style.display = 'block';
            },
        });
        contentUrl = "https://raw.githubusercontent.com/CrowdWare/QmlWasm/web/content/"
        theme = "1"
        foreground = ""
        background = ""
        primary = ""
        accent = "#00FF00"
        qtLoader.loadEmscriptenModule("appqmlwasm", contentUrl, theme, foreground, background, primary, accent);
    }

    window.addEventListener('hashchange', () => {
        var ptr  = qtLoader.module().allocate(qtLoader.module().intArrayFromString(window.location.hash), 'i8', 0);
        if(window.location.hash.length > 0)
          qtLoader.module()._hashchanged(ptr + 1);
        else
          qtLoader.module()._hashchanged(ptr);
    }, false);
    </script>
    <script type="text/javascript" src="qtloader.js"></script>
  </body>
</html>
